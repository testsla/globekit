"use strict";

var GK = GK || {};
GK.BackgroundDrawable = function(){
    var vertex = `
        precision highp float;

        attribute vec3 aPosition;
        attribute vec3 aNormal;
        attribute vec2 aTexture;

        uniform mat4 uMVMatrix;
        uniform mat4 uPMatrix;
        uniform vec3 uLightDir;

        varying vec2 vTexture;
        varying float vLightWeight;

        void main(void) {
            vec4 mvPosition = uMVMatrix * vec4(aPosition, 1.0);
            gl_Position = uPMatrix * mvPosition;

            vec3 transformedNormal = normalize(mat3(uMVMatrix) * aNormal);
            vec3 lightDirection = normalize(uLightDir - mvPosition.xyz);
            vLightWeight = max(dot(transformedNormal, lightDirection), 0.955);

            vTexture = aTexture;
        }
    `;

    var fragment = `
        precision highp float;

        varying vec2 vTexture;
        varying float vLightWeight;
        uniform sampler2D uSampler;
        uniform float uAlpha;

        void main(void) {
            vec4 textureColor = texture2D(uSampler, vTexture);
            gl_FragColor = vec4(textureColor.rgb * vLightWeight, textureColor.a * uAlpha);
        }
    `;

    var self = this;

    // WebGL
    var texture;
    var vertexBuffer;
    var indexBuffer;
    var vertexCount;
    var indexCount;

    var lightOrigin = vec3.fromValues(0.0, 0.0, 0.0);
    this.lightDir = vec3.fromValues(0.0, 0.0, 1.0);
    this.alpha = 1.0;

    this.modelMatrix = mat4.create();
    mat4.identity(this.modelMatrix);

    var texture = null;

    this.init = function() {
        this.program = GK.ProgramManager.create(vertex, fragment);
        var imgData = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAIAAABMXPacAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo4MjliY2VkNy0zYzU3LTRkZjgtOTg3OS00MWMyM2Y3NTY5ZmEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTZFQjJDMjI0N0VDMTFFNzg5RjdFQjc1MDEwOTJFNTMiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTZFQjJDMjE0N0VDMTFFNzg5RjdFQjc1MDEwOTJFNTMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKE1hY2ludG9zaCkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo1MWUxN2M2Mi1jZDcwLTQyZjEtOTJiZi0wNzE1M2Q4NDg1NGQiIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2YjRhMDM0Ny05MDU1LTExN2EtYTMx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";
        texture = GK.TextureManager.loadTexture(imgData, true, gl.CLAMP_TO_EDGE, gl.CLAMP_TO_EDGE);
        return this;
    }

    this.loadModel = function(model) {
        var vertices = model.vertices;
        var indices = model.indices;

        vertexCount = vertices.length;
        indexCount = indices.length;

        vertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);

        indexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);
    }

    this.draw = function(camera, time){
        if(!texture.loaded) return;
        gl.useProgram(this.program.name);

        this.lightDir = vec3.fromValues(-3.0, Math.sin(time * 0.001) * 2.0, Math.cos(time * 0.0008) * 4.0);

        gl.uniformMatrix4fv(this.program.uniforms.uPMatrix, false, camera.perspectiveMatrix);
        gl.uniformMatrix4fv(this.program.uniforms.uMVMatrix, false, this.modelMatrix);
        gl.uniform3fv(this.program.uniforms.uLightDir, this.lightDir);
        gl.uniform1f(this.program.uniforms.uAlpha, this.alpha);

        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, texture);
        gl.uniform1i(this.program.uniforms.uSampler, 0);

        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);

        gl.vertexAttribPointer(this.program.attributes.aPosition, 3, gl.FLOAT, false, 32, 0);
        gl.vertexAttribPointer(this.program.attributes.aNormal, 3, gl.FLOAT, false, 32, 12);
        gl.vertexAttribPointer(this.program.attributes.aTexture, 2, gl.FLOAT, false, 32, 24);

        gl.enableVertexAttribArray(this.program.attributes.aPosition);
        gl.enableVertexAttribArray(this.program.attributes.aNormal);
        gl.enableVertexAttribArray(this.program.attributes.aTexture);

        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
        gl.drawElements(gl.TRIANGLES, indexCount, gl.UNSIGNED_SHORT, 0);
    }
}

